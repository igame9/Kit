<!DOCTYPE html>
<html lang="en">
<head>
	<link href="css/mecss.css" rel="stylesheet"/>
	<script type="text/javascript">
        function getMe() {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "GetMe");
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onload = (e) => {
        var data = JSON.parse(e.target.response);
        var name = data.name;
        var family = data.family;
        var secondName = data.secondName;
        var university = data.university;
        var age = data.age;
        var course = data.course;
        var group = data.group;
        var login = data.login;
        var role = data.role;

        document.getElementById("me_name").value = name;
        document.getElementById("me_family").value = family;
        document.getElementById("me_secondName").value = secondName;
        document.getElementById("me_university").value = university;
        document.getElementById("me_age").value = age;
        document.getElementById("me_course").value = course;
        document.getElementById("me_group").value = group;
        document.getElementById("me_login").value = login;
        document.getElementById("me_role").value = role;

        if (xhr.status !== 200) {
            window.alert("Что-то пошло не так")
        }
    };
    var name = document.getElementById("me_name").value;
    var params1 = {
        "name": name
    };
    xhr.send(JSON.stringify(params1));
}

function overRide() {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "changeDB");
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.onload = (e) => {

        if (xhr.status !== 200) {
            window.alert("Что-то пошло не так")
        } else {
            alert(e.target.response);
        }
    };
    var name = document.getElementById("me_name").value;
    var fam = document.getElementById("me_family").value;
    var secondName = document.getElementById("me_secondName").value;
    var university = document.getElementById("me_university").value;
    var age = document.getElementById("me_age").value;
    var course = document.getElementById("me_course").value;
    var group = document.getElementById("me_group").value;
    var login = document.getElementById("me_login").value;
    var agtst = Number(age);
    var coutst = Number(course);

    var params1 = {
        "name": name,
        "family": fam,
        "secondName": secondName,
        "university": university,
        "age": age,
        "course": course,
        "group": group,
        "login": login
    };

    if (agtst && coutst < 1) {
        alert('Возраст и номер курса не могут быть меньше 1');
        return false;
    }

    if (!(Number.isInteger(agtst && coutst))) {
        alert('Возраст и номер группы должны быть числом');
        return false;
    }
    xhr.send(JSON.stringify(params1));
}
	</script>
	<meta charset="UTF-8">
	<title>Мой профиль</title>
</head>
<body onload="getMe()">
<header class="head">Ваш личный профиль</header>
<form onsubmit="overRide()">
	<p class="text"></p>
	<label>
		Имя:
		<input id="me_name" type="text" value="">
	</label><br>
	<label>
		Фамилия:
		<input id="me_family" type="text" value="">
	</label><br>
	<label>
		Отчество:
		<input id="me_secondName" type="text" value="">
	</label><br>
	<label>
		Место учебы:
		<input id="me_university" type="text" value="">
	</label><br>
	<label>
		Возраст:
		<input id="me_age" type="number" value="">
	</label><br>
	<label>
		Курс:
		<input id="me_course" type="number" value="">
	</label><br>
	<label>
		Группа:
		<input id="me_group" type="text" value="">
	</label><br>
	<label>
		Логин:
		<input id="me_login" disabled type="text" value="">
	</label><br>
	<label>
		Роль:
		<input id="me_role" disabled type="text" value="">
	</label><br>
	<label>
		<input class="button" type="submit"  value="Сохранить">
		<a style="color:black" href="site.html" class="ref">На главную</a>
	</label><br>
	<div class="picture"></div>
</form>
</body>
</html>